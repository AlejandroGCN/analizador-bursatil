graph TB

    %% ============================================
    %% ARQUITECTURA - 3 FUENTES VISIBLES Y LIMPIAS
    %% ============================================
    
    UI[üì± Streamlit Dashboard]
    
    EXTRACTOR[üéØ DataExtractor<br/>Facade Pattern]
    
    %% LAS 3 FUENTES EN PARALELO - ORGANIZADAS VERTICALMENTE
    subgraph SOURCES["üè≠ FUENTES DE DATOS - Cada fuente tiene Provider y Adapter"]
        direction LR
        
        subgraph YAHOO["Yahoo Finance"]
            direction TB
            Y1[YahooProvider<br/>‚¨á BaseProvider]
            Y2[YahooAdapter<br/>‚¨á BaseAdapter]
            Y1 --> Y2
        end
        
        subgraph BINANCE["Binance"]
            direction TB
            B1[BinanceProvider<br/>‚¨á BaseProvider]
            B2[BinanceAdapter<br/>‚¨á BaseAdapter]
            B1 --> B2
        end
        
        subgraph TIINGO["Tiingo"]
            direction TB
            T1[TiingoProvider<br/>‚¨á BaseProvider]
            T2[TiingoAdapter<br/>‚¨á BaseAdapter<br/>+ API Key]
            T1 --> T2
        end
    end
    
    %% APIs EXTERNAS
    YAPI[üåê Yahoo Finance API]
    BAPI[üåê Binance API]
    TAPI[üåê Tiingo API]
    
    %% PROCESAMIENTO
    NORM[‚öôÔ∏è Normalizer<br/>Unifica formatos OHLCV]
    
    SERIES[üìä Series de Datos<br/>Price ¬∑ Performance ¬∑ Volatility]
    
    %% SIMULACI√ìN
    PORT[üíº Portfolio<br/>Retornos logar√≠tmicos<br/>M√©tricas de riesgo]
    
    MC[üé≤ Monte Carlo Simulation<br/>Modelo GBM con log-returns<br/>Correcci√≥n de It√¥]
    
    %% ============================================
    %% FLUJO PRINCIPAL - LIMPIO Y NUMERADO
    %% ============================================
    
    UI -->|1. Solicita datos| EXTRACTOR
    EXTRACTOR -->|2. Delega| Y1 & B1 & T1
    
    Y2 -->|3. HTTP| YAPI
    B2 -->|3. HTTP| BAPI
    T2 -->|3. HTTP| TAPI
    
    YAPI -->|4. JSON| Y2
    BAPI -->|4. JSON| B2
    TAPI -->|4. JSON| T2
    
    Y1 -->|5. Normaliza| NORM
    B1 -->|5. Normaliza| NORM
    T1 -->|5. Normaliza| NORM
    
    NORM -->|6. Crea| SERIES
    SERIES -->|7. Alimenta| PORT
    PORT -->|8. Simula| MC
    MC -->|9. Resultados| UI
    
    
    %% ============================================
    %% ESTILOS
    %% ============================================
    
    style UI fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style EXTRACTOR fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    
    style Y1 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style B1 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style T1 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    style Y2 fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    style B2 fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    style T2 fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    
    style YAPI fill:#ffebee,stroke:#c62828,stroke-width:2px
    style BAPI fill:#ffebee,stroke:#c62828,stroke-width:2px
    style TAPI fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    style NORM fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style SERIES fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    style PORT fill:#f1f8e9,stroke:#689f38,stroke-width:3px
    style MC fill:#c5e1a5,stroke:#689f38,stroke-width:3px
