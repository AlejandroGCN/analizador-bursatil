graph LR
    %% ============================================
    %% DIAGRAMA 2: FLUJO Y ARQUITECTURA
    %% Horizontal - Muestra el flujo de datos
    %% ============================================
    
    UI[<br/>Streamlit<br/>Dashboard]
    
    FACADE[<br/>DataExtractor<br/><i>Facade</i>]
    
    subgraph SOURCES[" Fuentes de Datos"]
        direction TB
        PROV[Providers<br/>Yahoo 路 Binance 路 Tiingo]
        ADAP[Adapters<br/>Yahoo 路 Binance 路 Tiingo]
        PROV --> ADAP
    end
    
    APIS[<br/>APIs<br/>Externas]
    
    NORM[锔<br/>Normalizer<br/>OHLCV]
    
    SERIES[<br/>Series<br/>PriceSeries 路 PerformanceSeries]

    CLEANER[Ы<br/>DataCleaner]

    PORTFOLIO[<br/>Portfolio<br/>Log-returns]

    MC[<br/>Monte Carlo<br/>GBM + It么]

    REPORTS[<br/>Report Generator]

    RESULTS[<br/>Resultados]
    
    %% FLUJO PRINCIPAL
    UI -->|Paso 1 路 Request| FACADE
    FACADE -->|Paso 2 路 Delega| SOURCES
    SOURCES -->|Paso 3 路 HTTP| APIS
    APIS -->|Paso 4 路 JSON| SOURCES
    SOURCES -->|Paso 5 路 Datos| NORM
    NORM -->|Paso 6 路 Crea PriceSeries/PerformanceSeries| SERIES
    SERIES -->|Paso 7 路 Detecta NaN| CLEANER
    CLEANER -->|Paso 8 路 Limpia datos| PORTFOLIO
    PORTFOLIO -->|Paso 9 路 Simula| MC
    MC -->|Paso 10 路 Reporta| REPORTS
    REPORTS -->|Paso 11 路 Output| RESULTS
    RESULTS --> UI
    
    %% ESTILOS
    style UI fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style FACADE fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    style PROV fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style ADAP fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    style APIS fill:#ffebee,stroke:#c62828,stroke-width:2px
    style NORM fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style SERIES fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    style CLEANER fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    style PORTFOLIO fill:#f1f8e9,stroke:#689f38,stroke-width:3px
    style MC fill:#c5e1a5,stroke:#689f38,stroke-width:3px
    style REPORTS fill:#ede7f6,stroke:#4527a0,stroke-width:2px
    style RESULTS fill:#e3f2fd,stroke:#1976d2,stroke-width:2px

